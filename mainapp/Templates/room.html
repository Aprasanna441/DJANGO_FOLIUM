{% extends 'base.html' %}
 {% block title %}-Chat Room{% endblock %} 
 {% block content %}
 <p id="loc"></p>
<div style="width:100%; height:90vh; background-color: red;"></div>

<input id="chat-message-submit" type="button"  style="text-align:center;" value="Share" />
{{ room_name|json_script:"room-name" }}
<script>
  const roomName = JSON.parse(document.getElementById("room-name").textContent);

  sessionStorage.setItem("longitude", "25");
  sessionStorage.setItem("latitude", "36");
  const chatSocket = new WebSocket(
    "ws://" + window.location.host + "/ws/" + roomName + "/"
  );

  chatSocket.onmessage = function (e) {
    const data = JSON.parse(e.data);
    document.querySelector("#loc").innerHTML+= data.message + "\n";
    console.log(data.message[0])
  };

  chatSocket.onclose = function (e) {
    console.error("Chat socket closed unexpectedly");
  };

 

  // document.querySelector('#chat-message-submit').onclick = function(e) {
  // const messageInputDom = document.querySelector('#chat-message-input');

  function refreshLocation() {
    // const message = messageInputDom.value;
    if ("geolocation" in navigator) {
      // Get the user's current position
      navigator.geolocation.getCurrentPosition(function (position) {
        var latitude = position.coords.latitude;
        var longitude = position.coords.longitude;
        var accuracy = position.coords.accuracy;
        const message = [longitude, latitude];
       

        if (
          sessionStorage.getItem("longitude") == longitude &&
          sessionStorage.getItem("latitude") == latitude
        ) 
        {
        } else {
          sessionStorage.setItem("longitude", longitude);
          sessionStorage.setItem("latitude", latitude);
          chatSocket.send(
            JSON.stringify({
              message: message,
            })
          );
        }

        // chatSocket.send(
        //   JSON.stringify({
        //     message: message,
        //   })
        // );
        // messageInputDom.value = '';
      });
    }
  }
  setInterval(refreshLocation,500)
// refreshLocation()
</script>
{% endblock %}
